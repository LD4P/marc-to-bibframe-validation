[![Dependency Status](https://gemnasium.com/ld4l-labs/marc-to-bibframe-validation.svg)](https://gemnasium.com/ld4l-labs/marc-to-bibframe-validation)

# Marc to Bibframe Validation

This project is focused on validating the particulars of bibframe graphs produced from MARC data. Ruby RSpec is used as a means of validating the properties of data in the Bibframe model. We want evaluation code that can be run against bibframe resources to determine the quality of a conversion process.

This project should help us evaluate the quality of bibframe produced by different converters. This project provides a framework for calling external converter code to convert a single MARC record to an RDF::Graph object; the framework then provides tests for evaluating the resulting graph.

# Bib2LOD Conversion

This fork of the Marc to Bibframe validation project is focused on the use of the Bib2LOD converter being developed as part of the LD4L-Labs organization. The Bib2LOD code base is available at https://github.com/ld4l-labs/bib2lod.

# Approach

In order to make these tests agnostic for marc -> bibframe processing, the idea is that a helper method will be provided to get from an inline (known) marc record (as marcxml) to an RDF::Graph object holding bibframe triples.

For example, look at spec/support/m2bf_bib2lod_helpers.rb.  This class provides the marc_to_graph_bib2lod method.

# Install and Configure
To run the specs, the config.yml file must have the appropriate configuration information for the helper method that will be used.

For example, a config.yml to use the marc_to_graph_m2bf_xquery method is:
```
# Setting for callung the bib2lod converter
bib2lod_path:

# Settings for marc2bibframe LoC xquery converter
#   see spec/support/m2bf_bib2lod_helpers.rb
# location of clone repo from https://github.com/ld4l-labs/bib2lod
marc2bibframe_path: /Users/jgreben/Projects/bib2lod/target

# base URI to use for fake urls created
# base_uri: http://ld4p.library.org/
```

The helper_method property is required by the individual specs; the other properties are specific to the m2bf_bib2lod_helpers:
```
MARC2BIBFRAME_PATH = CONFIG_SETTINGS['marc2bibframe_path']
BASE_URI = CONFIG_SETTINGS['base_uri']
```
# The specs

Given known marc data, we should be able to describe exactly what we expect to be present in bibframe.

For example, we may know that a certain marc record should produce 4 works, with one instance for each work.  Another marc record might have only 1 work and 1 instance.

We also know that we would like to reconcile a work generated by a converter against existing works in existing RDF data, so data that facilitates this (e.g. standard numbers, titles, creators, publisher, pub date ...) is highly desirable as well.  Given specific marc data, we can test for specific information in titles, standard numbers, etc. in the produced bibframe graph.

# The data

See spec/fixtures

xxx.xml are MARCXML records provided for reference and for use by conversion programs.

xxx.rdfxml is the output from the converter run against the .marcxml records

xxx.ttl is a turtle representation of the same data as the .rdfxml file -- provided for human readability.

The specific marc records were chosen to try to exercise different wrinkles in work/instance information present in a single marc record.  As new work-instance wrinkles are surfaced, marc records and specs should be added to the project.

# Working with other converters

1. Create a xxx_helper.rb file in the spec/support folder:

    Module Helpers
        def marc_to_graph_my_converter(marcxml_str, param)
          a = method1
          graph = method2(a)
        end

        def method1
        end

        def method2
        end
    end

2. Have a method in your xxx_helper.rb file that takes marcxml as a string, a second argument (which can be ignored or used), and returns an RDF::Graph object loaded with the bibframe triples created by the converter for the passed marc.
3. Require your new helper file in spec/spec_helper.rb
4. config.yml should work when your method name from 2. is used as the value for helper_method.  If you need additional information (e.g. path to your converter), add it to config.yml and access the info via CONFIG_SETTINGS in your helper file.

spec/support/m2bf_xquery_helpers.rb is an exemplar.

# Importing Marc-To-Bibframe-Validation as a Converter Module

In your converter project, create a .gitmodules file with the following:
```
[submodule marc-to-bibframe-validation]
  path = marc-to-bibframe-validation
  url = https://github.com/ld4l-labs/marc-to-bibframe-validation.git
```
Then create a soft link in the `fixtures` folder to the sample data in the converter project. For example, if the converter keeps sample data under `{repos}/doc/sample-conversions` in this repos do:
```
cd spec/fixtures
ln -s ../../../doc/sample-conversions/ sample-conversions
```

# Contributing

1. Fork the repository.
2. Create a branch in your fork for your edits.
3. Create a new Pull Request. (https://help.github.com/articles/using-pull-requests/)
    - be clear about what problem the pull request is addressing
    
